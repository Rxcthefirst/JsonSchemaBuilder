<div class="advanced-array-editor">
  <div class="editor-header">
    <h4>Advanced Array Validation</h4>
    <div class="validation-preview">{{ getArrayValidationPreview() }}</div>
  </div>

  <!-- Validation Mode Selection -->
  <div class="validation-mode-section">
    <label class="section-label">Array Validation Mode:</label>
    <div class="mode-selection">
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="validationMode" 
          value="simple"
          (change)="onValidationModeChange()">
        <span>Simple (all items same schema)</span>
      </label>
      
      <label class="radio-option" [class.disabled]="!isDraft2020Available()">
        <input 
          type="radio" 
          [(ngModel)]="validationMode" 
          value="positional"
          [disabled]="!isDraft2020Available()"
          (change)="onValidationModeChange()">
        <span>Positional (prefixItems) 
          <small *ngIf="!isDraft2020Available()">[Draft 2020-12 only]</small>
        </span>
      </label>
      
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="validationMode" 
          value="advanced"
          (change)="onValidationModeChange()">
        <span>Advanced (mixed validation)</span>
      </label>
    </div>
  </div>

  <!-- Simple Mode: Items Schema -->
  <div class="items-section" *ngIf="validationMode === 'simple'">
    <label class="section-label">Items Validation:</label>
    
    <div class="items-mode-selection">
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="itemsMode" 
          value="allow"
          (change)="onItemsModeChange()">
        <span>Allow any items</span>
      </label>
      
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="itemsMode" 
          value="forbid"
          (change)="onItemsModeChange()">
        <span>Forbid all items</span>
      </label>
      
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="itemsMode" 
          value="schema"
          (change)="onItemsModeChange()">
        <span>Validate with schema</span>
      </label>
    </div>

    <!-- Items Schema Editor -->
    <div class="schema-editor" *ngIf="itemsMode === 'schema'">
      <div class="schema-templates">
        <label>Quick Templates:</label>
        <button 
          *ngFor="let template of getCommonSchemaTemplates()" 
          type="button" 
          class="template-btn"
          (click)="applySchemaTemplate(template, itemsSchema)">
          {{ template.name }}
        </button>
      </div>
      
      <div class="schema-fields">
        <div class="field-group">
          <label>Type:</label>
          <select [(ngModel)]="itemsSchema.type" (change)="updateItemsSchema(itemsSchema)">
            <option [value]="PropertyType.STRING">String</option>
            <option [value]="PropertyType.NUMBER">Number</option>
            <option [value]="PropertyType.INTEGER">Integer</option>
            <option [value]="PropertyType.BOOLEAN">Boolean</option>
            <option [value]="PropertyType.OBJECT">Object</option>
            <option [value]="PropertyType.ARRAY">Array</option>
          </select>
        </div>
        
        <div class="field-group">
          <label>Description:</label>
          <input 
            type="text" 
            [(ngModel)]="itemsSchema.description"
            (input)="updateItemsSchema(itemsSchema)"
            placeholder="Describe the array items">
        </div>
      </div>
    </div>
  </div>

  <!-- Positional Mode: PrefixItems -->
  <div class="prefix-items-section" *ngIf="validationMode === 'positional' || validationMode === 'advanced'">
    <div class="section-header">
      <label class="section-label">Position-Based Items (prefixItems):</label>
      <button type="button" class="add-btn" (click)="addPrefixItem()">
        <span>+ Add Position</span>
      </button>
    </div>

    <div class="prefix-items-list" *ngIf="prefixItemsList.length > 0">
      <div 
        class="prefix-item" 
        *ngFor="let item of prefixItemsList; let i = index; trackBy: trackByIndex">
        
        <div class="item-header">
          <span class="position-badge">Position {{ i }}</span>
          <div class="item-controls">
            <button 
              type="button" 
              class="move-btn" 
              (click)="movePrefixItemUp(i)"
              [disabled]="i === 0"
              title="Move Up">
              ↑
            </button>
            <button 
              type="button" 
              class="move-btn" 
              (click)="movePrefixItemDown(i)"
              [disabled]="i === prefixItemsList.length - 1"
              title="Move Down">
              ↓
            </button>
            <button 
              type="button" 
              class="remove-btn" 
              (click)="removePrefixItem(i)"
              title="Remove Position">
              ×
            </button>
          </div>
        </div>

        <div class="item-schema">
          <div class="schema-templates">
            <button 
              *ngFor="let template of getCommonSchemaTemplates()" 
              type="button" 
              class="template-btn small"
              (click)="applySchemaTemplate(template, item.schema)">
              {{ template.name }}
            </button>
          </div>
          
          <div class="schema-fields compact">
            <div class="field-row">
              <div class="field-group">
                <label>Type:</label>
                <select 
                  [(ngModel)]="item.schema.type" 
                  (change)="updatePrefixItemSchema(i, item.schema)">
                  <option [value]="PropertyType.STRING">String</option>
                  <option [value]="PropertyType.NUMBER">Number</option>
                  <option [value]="PropertyType.INTEGER">Integer</option>
                  <option [value]="PropertyType.BOOLEAN">Boolean</option>
                  <option [value]="PropertyType.OBJECT">Object</option>
                  <option [value]="PropertyType.ARRAY">Array</option>
                </select>
              </div>
              
              <div class="field-group flex-1">
                <label>Description:</label>
                <input 
                  type="text" 
                  [(ngModel)]="item.schema.description"
                  (input)="updatePrefixItemSchema(i, item.schema)"
                  placeholder="Describe this position's requirements">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="prefixItemsList.length === 0">
      <p>No positional items defined. Click "Add Position" to create position-based validation rules.</p>
    </div>
  </div>

  <!-- UnevaluatedItems (Draft 2020-12) -->
  <div class="unevaluated-items-section" *ngIf="(validationMode === 'positional' || validationMode === 'advanced') && isDraft2020Available()">
    <label class="section-label">Additional Items (unevaluatedItems):</label>
    
    <div class="unevaluated-mode-selection">
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="unevaluatedItemsMode" 
          value="allow"
          (change)="onUnevaluatedItemsModeChange()">
        <span>Allow additional items</span>
      </label>
      
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="unevaluatedItemsMode" 
          value="forbid"
          (change)="onUnevaluatedItemsModeChange()">
        <span>Forbid additional items</span>
      </label>
      
      <label class="radio-option">
        <input 
          type="radio" 
          [(ngModel)]="unevaluatedItemsMode" 
          value="schema"
          (change)="onUnevaluatedItemsModeChange()">
        <span>Validate additional items with schema</span>
      </label>
    </div>

    <!-- UnevaluatedItems Schema Editor -->
    <div class="schema-editor compact" *ngIf="unevaluatedItemsMode === 'schema'">
      <div class="schema-templates">
        <label>Quick Templates:</label>
        <button 
          *ngFor="let template of getCommonSchemaTemplates()" 
          type="button" 
          class="template-btn small"
          (click)="applySchemaTemplate(template, unevaluatedItemsSchema)">
          {{ template.name }}
        </button>
      </div>
      
      <div class="schema-fields compact">
        <div class="field-row">
          <div class="field-group">
            <label>Type:</label>
            <select [(ngModel)]="unevaluatedItemsSchema.type" (change)="updateUnevaluatedItemsSchema(unevaluatedItemsSchema)">
              <option [value]="PropertyType.STRING">String</option>
              <option [value]="PropertyType.NUMBER">Number</option>
              <option [value]="PropertyType.INTEGER">Integer</option>
              <option [value]="PropertyType.BOOLEAN">Boolean</option>
              <option [value]="PropertyType.OBJECT">Object</option>
              <option [value]="PropertyType.ARRAY">Array</option>
            </select>
          </div>
          
          <div class="field-group flex-1">
            <label>Description:</label>
            <input 
              type="text" 
              [(ngModel)]="unevaluatedItemsSchema.description"
              (input)="updateUnevaluatedItemsSchema(unevaluatedItemsSchema)"
              placeholder="Describe additional items schema">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Draft Version Note -->
  <div class="draft-note" *ngIf="!isDraft2020Available()">
    <p><strong>Note:</strong> Advanced array features like <code>prefixItems</code> and <code>unevaluatedItems</code> 
       are only available in JSON Schema Draft 2020-12. Switch to Draft 2020-12 to unlock these features.</p>
  </div>
</div>