<div class="schema-preview" *ngIf="schema">
  <div class="preview-header">
    <h3>Schema Preview</h3>
    <div class="preview-actions">
      <button type="button" 
              class="btn btn-sm btn-outline" 
              (click)="toggleView()"
              *ngIf="!isInteractiveMode && !showSampleMode">
        {{ showRawJson ? 'Show Summary' : 'Show JSON' }}
      </button>
      <button type="button" 
              class="btn btn-sm" 
              [class.btn-primary]="isInteractiveMode"
              [class.btn-outline]="!isInteractiveMode"
              (click)="toggleInteractiveMode()"
              *ngIf="enableInteractiveMode && !showSampleMode"
              title="Toggle Interactive Editor">
        {{ isInteractiveMode ? 'üéØ View Mode' : '‚úèÔ∏è Edit Mode' }}
      </button>
      <button type="button" 
              class="btn btn-sm" 
              [class.btn-primary]="showSampleMode"
              [class.btn-outline]="!showSampleMode"
              (click)="toggleSampleMode()"
              title="Generate Sample JSON Data">
        {{ showSampleMode ? 'üìã Schema Mode' : 'üé≤ Sample Mode' }}
      </button>
      <button type="button" 
              class="btn btn-sm btn-outline" 
              (click)="showSampleMode ? copySampleToClipboard() : copyToClipboard()">
        {{ showSampleMode ? 'Copy Sample' : 'Copy JSON' }}
      </button>
      <button type="button" 
              class="btn btn-sm btn-primary" 
              (click)="showSampleMode ? downloadSample() : downloadSchema()">
        {{ showSampleMode ? 'Download Sample' : 'Download Schema' }}
      </button>
    </div>
  </div>

  <div class="preview-content">
    <!-- Sample JSON Generation Mode -->
    <div class="sample-generator" *ngIf="showSampleMode">
      <div class="sample-controls">
        <div class="sample-options">
          <h4>Sample Generation Options</h4>
          <div class="options-grid">
            <label class="option-item">
              <input type="checkbox" [(ngModel)]="sampleOptions.includeOptionalProperties" (change)="updateSampleOptions()">
              Include Optional Properties
            </label>
            <label class="option-item">
              <input type="checkbox" [(ngModel)]="sampleOptions.useExampleValues" (change)="updateSampleOptions()">
              Use Example Values
            </label>
            <label class="option-item">
              <input type="checkbox" [(ngModel)]="sampleOptions.useDefaultValues" (change)="updateSampleOptions()">
              Use Default Values
            </label>
            <label class="option-item">
              <input type="checkbox" [(ngModel)]="sampleOptions.preferRealisticData" (change)="updateSampleOptions()">
              Realistic Data
            </label>
          </div>
          
          <div class="numeric-options">
            <div class="numeric-option">
              <label>Array Items:</label>
              <input type="number" [(ngModel)]="sampleOptions.arrayMinItems" min="0" max="10" (change)="updateSampleOptions()"> -
              <input type="number" [(ngModel)]="sampleOptions.arrayMaxItems" min="1" max="20" (change)="updateSampleOptions()">
            </div>
            <div class="numeric-option">
              <label>String Length:</label>
              <input type="number" [(ngModel)]="sampleOptions.stringMinLength" min="1" max="50" (change)="updateSampleOptions()"> -
              <input type="number" [(ngModel)]="sampleOptions.stringMaxLength" min="2" max="100" (change)="updateSampleOptions()">
            </div>
          </div>

          <div class="generation-actions">
            <button class="btn btn-sm btn-primary" (click)="generateSingleSample()" [disabled]="generatingSamples">
              üé≤ Generate Single Sample
            </button>
            <button class="btn btn-sm btn-outline" (click)="generateSamples(3)" [disabled]="generatingSamples">
              üéØ Generate 3 Samples
            </button>
            <button class="btn btn-sm btn-outline" (click)="generateSamples(5)" [disabled]="generatingSamples">
              üöÄ Generate 5 Samples
            </button>
          </div>
        </div>
      </div>

      <div class="sample-results" *ngIf="sampleResults.length > 0">
        <div class="sample-navigation">
          <h4>Sample {{ currentSampleIndex + 1 }} of {{ sampleResults.length }}</h4>
          <div class="sample-nav-buttons">
            <button class="btn btn-sm btn-outline" (click)="prevSample()" [disabled]="currentSampleIndex === 0">
              ‚Üê Previous
            </button>
            <button class="btn btn-sm btn-outline" (click)="nextSample()" [disabled]="currentSampleIndex === sampleResults.length - 1">
              Next ‚Üí
            </button>
          </div>
        </div>

        <div class="sample-content">
          <pre class="sample-json"><code>{{ getCurrentSampleJson() }}</code></pre>
        </div>

        <div class="sample-metadata" *ngIf="getCurrentSample()?.metadata">
          <h5>Generation Metadata</h5>
          <div class="metadata-stats">
            <span class="metadata-stat">
              üìä {{ getCurrentSample()?.metadata?.propertiesGenerated || 0 }} properties generated
            </span>
            <span class="metadata-stat">
              üîß {{ getCurrentSample()?.metadata?.optionalPropertiesIncluded || 0 }} optional included
            </span>
            <span class="metadata-stat">
              üí° {{ getCurrentSample()?.metadata?.examplesUsed || 0 }} examples used
            </span>
            <span class="metadata-stat">
              üéØ {{ getCurrentSample()?.metadata?.defaultsUsed || 0 }} defaults used
            </span>
          </div>
          
          <div class="metadata-warnings" *ngIf="getCurrentSample()?.metadata?.warnings?.length">
            <h6>Warnings:</h6>
            <ul>
              <li *ngFor="let warning of getCurrentSample()?.metadata?.warnings || []">{{ warning }}</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="sample-empty" *ngIf="sampleResults.length === 0 && !generatingSamples">
        <div class="empty-state">
          <div class="empty-icon">üé≤</div>
          <h3>Generate Sample JSON</h3>
          <p>Create realistic sample data based on your schema to test and validate your JSON structure.</p>
          <button class="btn btn-primary" (click)="generateSamples(3)">
            Generate Sample Data
          </button>
        </div>
      </div>

      <div class="sample-loading" *ngIf="generatingSamples">
        <div class="loading-spinner">‚è≥ Generating samples...</div>
      </div>
    </div>

    <!-- Interactive Monaco Editor Mode -->
    <div class="interactive-editor" *ngIf="isInteractiveMode && !showSampleMode">
      <div class="editor-info">
        <p class="editor-description">
          <strong>Interactive Mode:</strong> Edit the JSON Schema directly. Changes are synced automatically.
        </p>
      </div>
      <app-monaco-editor
        [value]="formattedJson"
        [options]="monacoOptions"
        [height]="'500px'"
        [showToolbar]="true"
        (valueChange)="onMonacoValueChange($event)"
        (editorReady)="onMonacoReady($event)"
        (validationChange)="onValidationChange($event)">
      </app-monaco-editor>
    </div>

    <!-- Traditional Summary View -->
    <div class="schema-summary" *ngIf="!isInteractiveMode && !showRawJson && !showSampleMode">
      <div class="summary-stats">
        <div class="stat-item">
          <label>Title:</label>
          <span>{{ schema.title || 'Untitled Schema' }}</span>
        </div>
        <div class="stat-item" *ngIf="schema.description">
          <label>Description:</label>
          <span>{{ schema.description }}</span>
        </div>
        <div class="stat-item">
          <label>Properties:</label>
          <span>{{ getSchemaStats().properties }}</span>
        </div>
        <div class="stat-item">
          <label>Required:</label>
          <span>{{ getSchemaStats().required }}</span>
        </div>
        <div class="stat-item">
          <label>Types Used:</label>
          <span class="types-list">
            <span class="type-badge" *ngFor="let type of getSchemaStats().types">
              {{ type }}
            </span>
          </span>
        </div>
        <div class="stat-item">
          <label>Additional Properties:</label>
          <span>{{ schema.additionalProperties ? 'Allowed' : 'Not Allowed' }}</span>
        </div>
      </div>

      <div class="schema-properties" *ngIf="hasProperties()">
        <h4>Properties</h4>
        <div class="properties-table">
          <div class="property-row header-row">
            <span class="property-name">Name</span>
            <span class="property-type">Type</span>
            <span class="property-required">Required</span>
            <span class="property-description">Description</span>
          </div>
          <div class="property-row" *ngFor="let prop of getPropertiesArray()">
            <span class="property-name">{{ prop.name }}</span>
            <span class="property-type">
              <span class="type-badge">{{ prop.type }}</span>
            </span>
            <span class="property-required">
              <span class="required-badge" [class.required]="prop.required">
                {{ prop.required ? '‚úì' : '‚úó' }}
              </span>
            </span>
            <span class="property-description">{{ prop.description || '-' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Traditional JSON View -->
    <div class="json-view" *ngIf="!isInteractiveMode && showRawJson && !showSampleMode">
      <pre class="json-content"><code>{{ formattedJson }}</code></pre>
    </div>
  </div>
</div>

<div class="no-schema" *ngIf="!schema">
  <p>No schema available for preview</p>
</div>
