<div class="compatibility-checker">
      <div class="checker-header">
        <h1>Schema Compatibility Checker</h1>
        <p class="description">
          Test schema compatibility and analyze potential breaking changes before deployment.
          Compare schemas across different compatibility modes and get detailed migration guidance.
        </p>
      </div>

      <div class="checker-content">
        <!-- Test Configuration -->
        <div class="test-config-panel">
          <h2>Create Compatibility Test</h2>
          
          <form [formGroup]="testForm" (ngSubmit)="runCompatibilityTest()" class="config-form">
            <div class="form-group">
              <label for="testName">Test Name*</label>
              <input 
                type="text" 
                id="testName"
                formControlName="testName"
                placeholder="Enter a descriptive name for this test"
                class="form-control"
              >
              <div class="error" *ngIf="testForm.get('testName')?.touched && testForm.get('testName')?.errors?.['required']">
                Test name is required
              </div>
            </div>

            <div class="form-group">
              <label for="description">Description</label>
              <textarea 
                id="description"
                formControlName="description"
                placeholder="Optional description of what this test validates"
                class="form-control"
                rows="2"
              ></textarea>
            </div>

            <div class="form-group">
              <label>Base Schema Source</label>
              <div class="radio-group">
                <label class="radio-option">
                  <input 
                    type="radio" 
                    formControlName="baseSource" 
                    value="registry"
                    (change)="onBaseSourceChange()"
                  >
                  <span>From Registry</span>
                </label>
                <label class="radio-option">
                  <input 
                    type="radio" 
                    formControlName="baseSource" 
                    value="manual"
                    (change)="onBaseSourceChange()"
                  >
                  <span>Manual Input</span>
                </label>
              </div>
            </div>

            <!-- Registry Schema Selection -->
            <div class="registry-selection" *ngIf="testForm.get('baseSource')?.value === 'registry'">
              <div class="form-group">
                <label for="subjectName">Subject Name</label>
                <input 
                  type="text" 
                  id="subjectName"
                  formControlName="subjectName"
                  placeholder="Enter subject name"
                  class="form-control"
                  (input)="onSubjectSearch($event)"
                >
                <div class="suggestions" *ngIf="subjectSuggestions.length > 0">
                  <div 
                    *ngFor="let subject of subjectSuggestions"
                    class="suggestion-item"
                    (click)="selectSubject(subject)"
                  >
                    {{ subject }}
                  </div>
                </div>
              </div>

              <div class="form-group" *ngIf="availableVersions.length > 0">
                <label for="baseVersion">Base Version</label>
                <select id="baseVersion" formControlName="baseVersion" class="form-control">
                  <option value="">Select version</option>
                  <option *ngFor="let version of availableVersions" [value]="version.version">
                    v{{ version.version }} ({{ version.createdAt | date:'short' }})
                  </option>
                </select>
              </div>
            </div>

            <!-- Manual Schema Input -->
            <div class="manual-input" *ngIf="testForm.get('baseSource')?.value === 'manual'">
              <div class="form-group">
                <label for="baseSchema">Base Schema (JSON)*</label>
                <div class="schema-input">
                  <textarea 
                    id="baseSchema"
                    formControlName="baseSchema"
                    placeholder="Paste your base JSON Schema here..."
                    class="form-control schema-textarea"
                    rows="8"
                  ></textarea>
                  <div class="schema-actions">
                    <button type="button" class="action-btn" (click)="formatSchema('base')">Format JSON</button>
                    <button type="button" class="action-btn" (click)="validateSchema('base')">Validate</button>
                    <button type="button" class="action-btn" (click)="clearSchema('base')">Clear</button>
                  </div>
                </div>
                <div class="validation-message" [class.success]="baseSchemaValid === true" [class.error]="baseSchemaValid === false">
                  <span *ngIf="baseSchemaValid === true">‚úì Valid JSON Schema</span>
                  <span *ngIf="baseSchemaValid === false">‚ö†Ô∏è {{ baseSchemaError }}</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="candidateSchema">Candidate Schema (JSON)*</label>
              <div class="schema-input">
                <textarea 
                  id="candidateSchema"
                  formControlName="candidateSchema"
                  placeholder="Paste your candidate JSON Schema here..."
                  class="form-control schema-textarea"
                  rows="8"
                ></textarea>
                <div class="schema-actions">
                  <button type="button" class="action-btn" (click)="formatSchema('candidate')">Format JSON</button>
                  <button type="button" class="action-btn" (click)="validateSchema('candidate')">Validate</button>
                  <button type="button" class="action-btn" (click)="clearSchema('candidate')">Clear</button>
                </div>
              </div>
              <div class="validation-message" [class.success]="candidateSchemaValid === true" [class.error]="candidateSchemaValid === false">
                <span *ngIf="candidateSchemaValid === true">‚úì Valid JSON Schema</span>
                <span *ngIf="candidateSchemaValid === false">‚ö†Ô∏è {{ candidateSchemaError }}</span>
              </div>
            </div>

            <div class="form-group">
              <label for="compatibilityMode">Compatibility Mode*</label>
              <select id="compatibilityMode" formControlName="compatibilityMode" class="form-control">
                <option value="BACKWARD">Backward - New schema can read data from old schema</option>
                <option value="FORWARD">Forward - Old schema can read data from new schema</option>
                <option value="FULL">Full - Both backward and forward compatible</option>
                <option value="NONE">None - No compatibility requirements</option>
              </select>
            </div>

            <div class="form-actions">
              <button 
                type="submit" 
                class="run-test-btn"
                [disabled]="!testForm.valid || isRunningTest"
              >
                <span *ngIf="!isRunningTest">Run Compatibility Test</span>
                <span *ngIf="isRunningTest" class="loading">
                  <span class="spinner"></span>
                  Running Test...
                </span>
              </button>
              <button type="button" class="reset-btn" (click)="resetForm()">Reset Form</button>
            </div>
          </form>
        </div>

        <!-- Test Results -->
        <div class="test-results-panel" *ngIf="currentTest">
          <h2>Test Results</h2>
          
          <div class="result-header">
            <div class="test-info">
              <h3>{{ currentTest.name }}</h3>
              <p class="test-description" *ngIf="currentTest.description">{{ currentTest.description }}</p>
              <div class="test-meta">
                <span class="meta-item">Mode: {{ currentTest.compatibilityMode }}</span>
                <span class="meta-item">Created: {{ currentTest.createdAt | date:'short' }}</span>
                <span class="meta-item" *ngIf="currentTest.subjectName">Subject: {{ currentTest.subjectName }}</span>
              </div>
            </div>
            <div class="result-status" [attr.data-status]="currentTest.status">
              <div class="status-indicator">
                <span *ngIf="currentTest.status === 'completed'" class="status-icon">‚úì</span>
                <span *ngIf="currentTest.status === 'error'" class="status-icon">‚ö†Ô∏è</span>
                <span *ngIf="currentTest.status === 'running'" class="spinner"></span>
              </div>
              <span class="status-text">{{ getStatusText() }}</span>
            </div>
          </div>

          <!-- Error State -->
          <div class="error-result" *ngIf="currentTest.status === 'error'">
            <div class="error-content">
              <h4>Test Failed</h4>
              <p>{{ currentTest.error }}</p>
              <button class="retry-btn" (click)="retryTest()">Retry Test</button>
            </div>
          </div>

          <!-- Completed Results -->
          <div class="compatibility-results" *ngIf="currentTest.status === 'completed' && currentTest.analysis">
            
            <!-- Overall Result -->
            <div class="overall-result" [class.compatible]="currentTest.analysis.isBackwardCompatible" [class.incompatible]="!currentTest.analysis.isBackwardCompatible">
              <div class="result-icon">
                <span *ngIf="currentTest.analysis.isBackwardCompatible">‚úÖ</span>
                <span *ngIf="!currentTest.analysis.isBackwardCompatible">‚ùå</span>
              </div>
              <div class="result-text">
                <h4>{{ currentTest.analysis.isBackwardCompatible ? 'Compatible' : 'Incompatible' }}</h4>
                <p>{{ getCompatibilityMessage() }}</p>
              </div>
            </div>

            <!-- Summary Stats -->
            <div class="result-summary">
              <div class="summary-stat">
                <div class="stat-number">{{ currentTest.analysis.changes.length }}</div>
                <div class="stat-label">Total Changes</div>
              </div>
              <div class="summary-stat breaking" *ngIf="getBreakingChanges().length > 0">
                <div class="stat-number">{{ getBreakingChanges().length }}</div>
                <div class="stat-label">Breaking Changes</div>
              </div>
              <div class="summary-stat warnings" *ngIf="getWarningChanges().length > 0">
                <div class="stat-number">{{ getWarningChanges().length }}</div>
                <div class="stat-label">Warnings</div>
              </div>
              <div class="summary-stat risk" [attr.data-risk]="getRiskLevel()">
                <div class="stat-indicator">{{ getRiskIcon() }}</div>
                <div class="stat-label">{{ getRiskLevel() }} Risk</div>
              </div>
            </div>

            <!-- Changes Detail -->
            <div class="changes-section" *ngIf="currentTest.analysis.changes.length > 0">
              <div class="section-header">
                <h4>Detected Changes</h4>
                <div class="filter-controls">
                  <select [(ngModel)]="resultsFilter" (change)="applyResultsFilter()">
                    <option value="">All Changes</option>
                    <option value="breaking">Breaking Only</option>
                    <option value="warnings">Warnings Only</option>
                    <option value="safe">Safe Changes</option>
                  </select>
                </div>
              </div>

              <div class="changes-list">
                <div 
                  *ngFor="let change of getFilteredResults(); trackBy: trackByChange"
                  class="change-item"
                  [class.breaking]="change.breaking"
                  [class.warning]="isWarningChange(change)"
                >
                  <div class="change-header">
                    <div class="change-info">
                      <span class="change-type">{{ change.type }}</span>
                      <span class="change-field" *ngIf="change.field">{{ change.field }}</span>
                    </div>
                    <div class="change-indicators">
                      <span class="impact-badge" [attr.data-impact]="change.impact">{{ change.impact }}</span>
                      <span class="breaking-badge" *ngIf="change.breaking">Breaking</span>
                    </div>
                  </div>
                  
                  <div class="change-description">
                    {{ change.description }}
                  </div>

                  <div class="change-details" *ngIf="change.oldValue !== undefined || change.newValue !== undefined">
                    <div class="value-change">
                      <div class="old-value" *ngIf="change.oldValue !== undefined">
                        <span class="label">Before:</span>
                        <code>{{ formatChangeValue(change.oldValue) }}</code>
                      </div>
                      <div class="new-value" *ngIf="change.newValue !== undefined">
                        <span class="label">After:</span>
                        <code>{{ formatChangeValue(change.newValue) }}</code>
                      </div>
                    </div>
                  </div>

                  <div class="mitigation-advice" *ngIf="getMitigationAdvice(change)">
                    <div class="advice-header">üí° Mitigation Advice:</div>
                    <div class="advice-text">{{ getMitigationAdvice(change) }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Migration Path -->
            <div class="migration-section" *ngIf="currentTest.analysis.migrationPath.length > 0">
              <h4>Migration Path</h4>
              <div class="migration-steps">
                <div 
                  *ngFor="let step of currentTest.analysis.migrationPath; let i = index"
                  class="migration-step"
                >
                  <div class="step-number">{{ i + 1 }}</div>
                  <div class="step-content">
                    <div class="step-title">{{ step.action }}</div>
                    <div class="step-description">{{ step.description }}</div>
                    <pre class="step-code" *ngIf="step.code">{{ step.code }}</pre>
                  </div>
                </div>
              </div>
            </div>

            <!-- Export Options -->
            <div class="export-section">
              <h4>Export Results</h4>
              <div class="export-options">
                <button class="export-btn" (click)="exportResults('json')">
                  <span class="btn-icon">üìÑ</span>
                  Export as JSON
                </button>
                <button class="export-btn" (click)="exportResults('report')">
                  <span class="btn-icon">üìã</span>
                  Generate Report
                </button>
                <button class="export-btn" (click)="shareResults()">
                  <span class="btn-icon">üîó</span>
                  Share Results
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Test History -->
        <div class="test-history-panel" *ngIf="testHistory.length > 0">
          <h2>Test History</h2>
          
          <div class="history-controls">
            <div class="search-box">
              <input 
                type="text" 
                placeholder="Search tests..."
                [(ngModel)]="historySearchTerm"
                (input)="filterHistory()"
                class="search-input"
              >
            </div>
            <button class="clear-history-btn" (click)="clearHistory()">Clear History</button>
          </div>

          <div class="history-list">
            <div 
              *ngFor="let test of filteredHistory; trackBy: trackByTest"
              class="history-item"
              (click)="loadTest(test)"
              [class.active]="currentTest?.id === test.id"
            >
              <div class="history-header">
                <div class="test-name">{{ test.name }}</div>
                <div class="test-date">{{ test.createdAt | date:'short' }}</div>
              </div>
              
              <div class="history-details">
                <span class="detail-item">{{ test.compatibilityMode }}</span>
                <span class="detail-item" *ngIf="test.subjectName">{{ test.subjectName }}</span>
                <span class="status-badge" [attr.data-status]="test.status">{{ test.status }}</span>
              </div>

              <div class="history-result" *ngIf="test.analysis">
                <span class="result-indicator" [class.compatible]="test.analysis.isBackwardCompatible">
                  {{ test.analysis.isBackwardCompatible ? '‚úÖ Compatible' : '‚ùå Incompatible' }}
                </span>
                <span class="changes-count">{{ test.analysis.changes.length }} changes</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>